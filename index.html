<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
        <title>Canvas over Video</title>

        <!-- Bootstrap -->
        <link href="css/bootstrap.min.css" rel="stylesheet">

        <!-- Darkly theme -->
        <link rel="stylesheet" href="css/darkly.min.css">


        <style>
            .canvasHome {
                position: absolute;
            }

            .theVideo {
                position: absolute;
            }

            .canMeasure {
                visibility: hidden;
            }

            .wow {
                background-color: cornflowerblue;
            }
            
            .wow2 {
                background-color: forestgreen;
            }

            .slider {
                position: absolute;
                top: 300px;
                left: 85px;
                width: 152px;
                height: 52px;
            }
            .bar {
                position: relative;
                top: 30px;
                width: 152px;
                height: 2px;
                background-color: #404040 ;
            }
            /*
            .knob {
            position: relative;
            left: 100px;
            border: 1px solid #404040;
            background-color: #C0C0C0 ;
            width: 50px;
            height: 50px;
            border-radius: 25px;
            text-align: center;
            }
            */

            #spread {
                height: 100%;
                background-color: chartreuse;
            }
        </style>

        <!-- Javascript -->
        <script>
            function _n(x) {
                return document.getElementsByName(x);
            }
            
            function _(x) {
                var x = document.getElementById(x);
                return x;
            }

            function _2d(x) {
                var x = document.querySelector(x);
                x.getContext("2d");
                return x;
            }
        </script>


    </head>
    <!--  <body onload="init()">-->
    <body>
        
        <div class="container">
            <div class="row">
                <section class="col-xs-12">
                    
                    <div class="container col-xs-6">
                        <div class="row">
                        <canvas id="canMeasure"></canvas>
                        <!--            <canvas id="canAlpha"></canvas>-->
<!--                        <video class="row img-responsive" id="theVideo" autoplay loop>-->
                        <video class="row img-responsive" id="theVideo" loop>
<!--                            <source src="videos/aiStore.mp4" type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"'>-->
                            <source src="videos/videoplayback.mp4" type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"'>
                        </video>
                        
                        </div>
                        <div class="row">
                            <div class="col-xs-3 col-md-3">
                                <a href="#" class="btn btn-default col-xs-12 col-md-12 btnPlay" id="btnPlay"><span class="glyphicon glyphicon-pause"></span></a>
                            </div>
                            <div class="col-xs-3 col-md-3">
    <!--                            <a href="#" class="btn btn-default col-xs-12 col-md-12 btnMeasure" id="btnMeasure">Measure <span class="glyphicon glyphicon-eye-open"></span></a>-->
                                <a href="#" class="btn btn-default col-xs-12 col-md-12 btnMeasure" id="btnMeasure">Measure <span class="glyphicon glyphicon-eye-close"></span></a>
                            </div>
                            <div class="col-xs-3 col-md-3">
                                <a href="#" class="btn btn-default col-xs-12 col-md-12" onclick="toggleVideo();">Video</a>
                            </div>
                            <div class="col-xs-3 col-md-3">
                                <a href="#" class="btn btn-default col-xs-12 col-md-12" onclick="openVideo();">Open Video</a>
                            </div>
                        </div>
                    </div>
                    <div class="container col-xs-6 col-sm-6 col-md-6">

                        
<!--
                    <div class="panel panel-default">
                        <div class="panel-body">
-->
<!--                            <table id="tt" border="1" style="width:100%">-->
                        <div class="table-responsive">
                        
                            <table id="tt" border="1" class="table table-striped table-condensed">
                                <thead>
                                    <tr>
                                        <th><span class="maintitle">Task</span></th>
                                        <th colspan=7 align=left><span class="maintitle">Pallet lift</span></th>
                                    </tr>

                                    <tr>
                                        <th colspan=2></th>
                                        <th colspan=6><span class="subtitle">Input</span></th>
                                    </tr>

                                    <tr>
                                        <th colspan=2></th>
                                        <th colspan=4><span class="subtitle">Shoulder</span></th>
                                        <th colspan=2><span class="subtitle">Back</span></th>
                                    </tr>

                                    <tr>
                                        <th colspan=1>Video Time Code</th>
                                        <th colspan=1>Step of Task</th>
                                        <th colspan=1>Load<br /><span class="short">lbs</span></th>
                                        <th colspan=1>HS<br /><span class="short">in.</span></th>
                                        <th colspan=1>Vert<br /><span class="short">factor</span></th>
                                        <th colspan=1>Latri<br /><span class="short">factor</span></th>
                                        <th colspan=1>Load<br /><span class="short">lbs</span></th>
                                        <th colspan=1>Bend<br /><span class="short">fraction</span></th>
                                    </tr>
                                </thead>

                                <tbody id="ttBody">
                                    <form name="vform" id="vform"></form>
                                    <div id="dynamicInput"></div>
                                    <div id="formValues"></div>
                                </tbody>
                            </table>                        
                        
                        </div>

<!--
                        </div>
                    </div>
                        
-->
                        
                    </div>
                </section>
            </div>
            
            <div class="row">
            
                    <div class="row-fluid col-xs-12 col-md-12">
                        <form>
                            <label for="increment">Time Increment</label>
                            <select name="increment" id="increment">
                            <option value="0.25" >0.25
                            <option selected value="0.5" >0.5
                            <option value="0.75" >0.75
                            <option value="1" >1
                            <option value="1.25" >1.25
                            <option value="1.5" >1.5
                            <option value="1.75" >1.75
                            <option value="2" >2
                            </select>

                            <br />
                            <label for="videoLength">Video Length in seconds</label>
                            <input type=text name="videoLength" id="videoLength" value="20">
                            <br />
                            <input type="button" id="addMoreRows" value="Create fields" onclick="addRows()" />
                            <input type="button" id="clearAllRows2" value="Clear All Rows" onclick="clearAllRows()" />
                            <input type="reset">
                        </form>
                    </div>
                
            </div>
            
            
            <div class="=row">
            
        <video id="video" width="640" height="480" autoplay></video>
        <button id="snap">Snap Photo</button>
        <canvas id="canvas" width="640" height="480"></canvas>
            
            </div>
            
        </div>
        




    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="js/jquery-2.2.4.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>      


    <!-- Javascript -->
    <script>
        var vid = _("theVideo");

        $(document).ready(function() {
            /* initialize canvases */
            setCanvases();

            /* create spreadsheet fields */
            buildSpreadsheet();

            /* draw tools */
            drawMeasure();

            /* initialize buttons */
            playButton = _("play");
        })

        $('.btnPlay').on('click', function() {
            var video = $('#theVideo');
            var button = $('.btnPlay');
            if(video[0].paused) {
                video[0].play();
                button.children("span").toggleClass("glyphicon glyphicon-play", false);
                button.children("span").toggleClass("glyphicon glyphicon-pause", true);
            }
            else {
                video[0].pause();
                button.children("span").toggleClass("glyphicon glyphicon-pause", false);
                button.children("span").toggleClass("glyphicon glyphicon-play", true);
            }
        })
        
        $('.btnMeasure').on('click', function() {
            var can = _('canMeasure');
            var button = $('.btnMeasure');
            
            if(can.style.visibility == 'hidden') {
//                can.visibility = 'visible';
                button.children("span").toggleClass("glyphicon glyphicon-eye-close", false);
                button.children("span").toggleClass("glyphicon glyphicon-eye-open", true);
            }
            else {
//                can.visibility = 'hidden';
                button.children("span").toggleClass("glyphicon glyphicon-eye-open", false);
                button.children("span").toggleClass("glyphicon glyphicon-eye-close", true);
            }
            
            toggle_visibility('canMeasure');
        })
        
        function openVideo() {
            alert('openVideo');
            if(navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia ({ video: true }).then(function(stream) { 
                video.src = window.URL.createObjectURL(stream);
                video.play();
                });
            }
            
            /* Legacy code below: getUserMedia 
            else if(navigator.getUserMedia) { // Standard
                navigator.getUserMedia({ video: true }, function(stream) {
                    video.src = stream;
                    video.play();
                }, errBack);
            } else if(navigator.webkitGetUserMedia) { // WebKit-prefixed
                navigator.webkitGetUserMedia({ video: true }, function(stream){
                    video.src = window.webkitURL.createObjectURL(stream);
                    video.play();
                }, errBack);
            } else if(navigator.mozGetUserMedia) { // Mozilla-prefixed
                navigator.mozGetUserMedia({ video: true }, function(stream){
                    video.src = window.URL.createObjectURL(stream);
                    video.play();
                }, errBack);
            }
            */
        }

        function setCanvases() {
            var can = _('canMeasure');
            can.style.visibility = 'hidden';
            
            setToVideoPosition('canMeasure');
            
            

        }

        function buildSpreadsheet() {
            var frames = vid.length;
//            alert(frames);
        }

        function setToVideoPosition(element) {
            var can = _(element);
            can.style.top = vid.clientTop+"px";
            can.style.left = vid.clientLeft+"px";
            can.style.position = "absolute";
            can.getContext('2d');
        }

        function setToVideoSize(element) {
            var vid = _("theVideo");
            var can = _(element);
            can.style.height = vid.clientHeight+"px";
            can.style.width = vid.clientWidth+"px";
            can.style.top = vid.clientTop+"px";
            can.style.left = vid.clientLeft+"px";
            can.style.position = "absolute";
            can.getContext('2d');
        }

        function drawMeasure() {
            var can = _('canMeasure');
            var ctx = can.getContext('2d');
            var img = new Image();
            img.src = "images/ruler.png";
            img.onload = function() {
                var val1 = Math.round((can.width / 2) - (img.width / 2 ));
                var val2 = Math.round((can.height / 2) - (img.height / 2 ));
                ctx.drawImage(img, 0, 0, img.width, img.height, val1, val2, img.width, img.height);
            }
        }

        function toggleMeasure() {
            toggle_visibility('canMeasure');
        }

        function toggleVideo() {
            toggle_visibility('theVideo');
        }

        function toggle_visibility(id) {
            var e = _(id);
            if (e.style.visibility == 'visible')
                e.style.visibility = 'hidden';
            else
                e.style.visibility = 'visible';
        }

        function drawCurve() {
            var c = _('canAlpha').getContext("2d");
            //            var c = document.querySelector("canAlpha").getContext("2d");
            c.beginPath();
            c.moveTo(10,90);
            c.bezierCurveTo(10, 10, 90, 10, 50, 90);
            c.lineTo(90, 10);
            c.lineTo(10, 10);
            c.closePath();
            c.stroke();
            //            draw('canAlpha', img, true, false);
        }
        
        function clearAllRows() {
//            var p = _('tt');
            var p = _('ttBody');
            p.innerHTML = '';
            return true;
        }
        
        function addEndOfLine()
        {
            var eol = '';
            eol+='<td align=right colspan=7><input type="submit" onclick="countFields();" /></td>';
            eol+='<td align=right colspan=1><input type="reset" /></td>';
            eol+='</tr></form></tbody>';
            // _("tt").insertRow(-1).innerHTML = eol;
            _("ttBody").insertRow(-1).innerHTML = eol;
        }

        function addLine(count)
        {
            var c = count.toString();
            var index = c.indexOf(".");

            if ((index == -1) && (c.length = 1))
            {
                dcount = c.concat(".0");
            }
            else
                dcount = c;

            field = '<tr><td><span class="data">'+dcount+'</span></td>';
            field+='<td><input type="text" size=10 name="step[]" /></td>';
            field+='<td><input type="text" size=3 name="shoulder_load[]" /></td>';
            field+='<td><input type="text" size=3 name="shoulder_hs[]" /></td>';
            field+='<td><input type="text" size=3 name="shoulder_vert[]" /></td>';
            field+='<td><input type="text" size=3 name="shoulder_latri[]" /></td>';
            field+='<td><input type="text" size=3 name="back_load[]" /></td>';
            field+='<td><input type="text" size=3 name="back_bend[]" /></td></tr>';
            
//            field = '<tr><td align=middle><span class="data">'+dcount+'</span></td>';
//            field+='<td align=left><input type="text" size=5 name="step[]" /></td>';
//            field+='<td align=right><input type="text" size=5 name="shoulder_load[]" /></td>';
//            field+='<td align=right><input type="text" size=5 name="shoulder_hs[]" /></td>';
//            field+='<td align=right><input type="text" size=5 name="shoulder_vert[]" /></td>';
//            field+='<td align=right><input type="text" size=5 name="shoulder_latri[]" /></td>';
//            field+='<td align=right><input type="text" size=5 name="back_load[]" /></td>';
//            field+='<td align=right><input type="text" size=5 name="back_bend[]" /></td></tr>';
//            _("tt").insertRow(-1).innerHTML = field;
            _("ttBody").insertRow(-1).innerHTML = field;
        }

        function addRows()
        {
            var n = _("increment");
            var inc = parseFloat(n.options[n.selectedIndex].value);
            var sec = _("videoLength").value;
            var i = 0;
            do
            {
                addLine(i);
                i = (inc * 10 + i * 10) / 10;
            } while (i < sec);
            addLine(i);
            addEndOfLine();
        }

        function countFields()
        {
            var str = '';
            var elem1 = _n('step[]');
            var elem2 = _n('shoulder_load[]');
            var elem3 = _n('shoulder_hs[]');
            var elem4 = _n('shoulder_vert[]');
            var elem5 = _n('shoulder_latri[]');
            var elem6 = _n('back_load[]');
            var elem7 = _n('back_bend[]');

            for (var i=0;i<elem1.length;i++)
            {
                str += elem1[i].value + "|" + elem2[i].value + "|" + elem3[i].value + "|" + elem4[i].value + "|" + elem5[i].value + "|" + elem6[i].value + "|" + elem7[i].value;
                str += "<br />";
            }
            _('formValues').innerHTML = str;
        }
    </script>


    </body>
</html>